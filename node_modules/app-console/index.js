var express = require('express');
var router = express.Router();
var passport = require('passport');
var Localpassport = require('passport-local');



router.get("/admin/logout", function( req, res, next ){
    if( req.isAuthenticated() )
    {
        req.logOut();
        res.redirect( "/admin" );
    }
})

router.get('/admin(/)?(:error)?', function(req, res, next) {

    if( req.isAuthenticated() )
    {
        res.render('app-console/index', {title: 'Express'});
    }
        else
    {
        var error;
        if( req.params.error != 'undefined' && req.params.error )var error = "Неверный логин или пароль";
        res.render('app-console/login', {error: error});
    }

});

router.post('/', function( req, res, next ){
    passport.authenticate('local', function(err, user, info) {
        if (err) { return next(err); }
        if (!user) { return res.redirect('/admin/error'); }

        req.logIn(user, function(err) {
            if (err) { return next(err); }
            return res.redirect('/admin' );
        });
    })(req, res, next);
});



module.exports = router;